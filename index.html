<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telescope - Financial Forecasting</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ADD8E6 0%, #90D5FF 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header .logo {
            max-height: 107px;
            height: auto;
            max-width: 90%;
            object-fit: contain;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .tab.active {
            background: white;
            color: #3498db;
            transform: translateY(-3px);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .layout {
            display: flex;
            gap: 20px;
        }
        
        .sidebar {
            flex: 0 0 400px;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 10px;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .sidebar.collapsed {
            flex: 0 0 50px;
            padding: 10px 5px;
        }
        
        .sidebar-toggle {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        
        .sidebar-toggle-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .sidebar-toggle-btn:hover {
            transform: translateX(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .sidebar.collapsed .sidebar-toggle-btn {
            transform: rotate(180deg);
        }
        
        .sidebar.collapsed .sidebar-toggle-btn:hover {
            transform: rotate(180deg) translateX(-2px);
        }
        
        .sidebar-content {
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Collapsed Sidebar Icon Strip */
        .sidebar-collapsed-icons {
            display: none;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            padding: 10px 0;
        }
        
        .sidebar.collapsed .sidebar-collapsed-icons {
            display: flex;
        }
        
        .sidebar-icon-item {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .sidebar-icon-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .sidebar-icon-item:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50px;
            background: #2c3e50;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            white-space: nowrap;
            font-size: 0.85rem;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .sidebar-expand-icon {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            font-size: 1.1rem;
        }
        
        .main {
            flex: 1;
            min-width: 0;
        }
        
        .controls {
            background: #ffffff;
            padding: 12px;
            margin-bottom: 16px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .control-group {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-item label {
            font-weight: 600;
            color: #495057;
            min-width: 92px;
            font-size: 0.85rem;
        }
        
        .control-item input, .control-item select {
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .control-item select {
            max-width: 200px;
        }
        
        .control-item input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .run-forecast-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 20px;
        }
        
        .run-forecast-btn:hover {
            background: #2980b9;
        }
        
        .run-forecast-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .statements-container {
            display: block;
            margin-bottom: 30px;
        }
        
        .independent-table-container {
            margin-bottom: 20px;
            width: 100%;
        }
        
        .statement-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .statement-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .table-container {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            margin: 0;
            padding: 0;
            position: relative;
            scroll-behavior: smooth;
        }

        .table-wrapper {
            overflow: visible;
            width: 100%;
        }

        /* Hide scrollbar but keep functionality - natural scrolling like sidebar */
        .table-container::-webkit-scrollbar {
            display: none;
        }
        
        .table-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        table {
            width: max-content;
            border-collapse: collapse;
            background: white;
            font-size: 0.85rem;
            min-width: 1600px;
        }
        
        th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #e9ecef;
            white-space: nowrap;
        }

        /* Sticky first column for better context while scrolling */
        th:first-child {
            position: sticky;
            left: 0;
            z-index: 12;
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }
        td:first-child {
            position: sticky;
            left: 0;
            background: white;
            z-index: 11;
            border-right: 2px solid #e9ecef;
        }
        
        .metric-name {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }
        
        .total-row td {
            font-weight: 700;
            border-top: 2px solid #adb5bd;
            background: #f1f3f5;
        }
        
        .actual {
            background-color: #e8f5e8;
            color: #27ae60;
            font-weight: 600;
        }
        
        .forecast {
            background-color: #fff3cd;
            color: #856404;
            font-weight: 600;
        }
        
        .note-badge {
            display: inline-block;
            background: #ffc107;
            color: #212529;
            border-radius: 6px;
            padding: 0 6px;
            margin-left: 6px;
            font-size: 0.7rem;
            vertical-align: middle;
            cursor: help;
        }
        
        .mixed-period-indicator {
            background: #dc3545;
            color: white;
            cursor: pointer;
            position: relative;
        }
        
        .custom-tooltip {
            position: absolute;
            background: #2c3e50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.4;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            white-space: pre-line;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .custom-tooltip.show {
            opacity: 1;
        }
        
        .custom-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }
        
        .number {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        
        .positive {
            color: #27ae60;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .forecast-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 0;
        }
        
        .export-btn:hover {
            background: #219a52;
        }
        
        .placeholder {
            color: #6c757d;
        }
        
        .placeholder::after {
            content: ' *';
            color: #dc3545;
            font-weight: bold;
        }
        
        .csv-format-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
        }
        
        .csv-format-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .csv-format-info code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        /* Chat Container Styles */
        .chat-container {
            height: 250px;
            display: flex;
            flex-direction: column;
            border: 2px solid #3498db;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .chat-messages {
            flex: 1;
            padding: 10px;
            background: #f8f9fa;
            max-height: 300px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Help Button Styles */
        .help-button {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 5px;
            margin-right: 5px;
            vertical-align: middle;
            transition: background-color 0.2s;
        }

        .help-button:hover {
            background: #2980b9;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .method-explanation {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }

        .method-explanation strong {
            color: #2c3e50;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        .chat-message.user {
            background: #3498db;
            color: white;
            margin-left: 20px;
        }
        
        .chat-message.assistant {
            background: white;
            border: 1px solid #e9ecef;
            margin-right: 20px;
        }
        
        .message-content ul {
            margin: 5px 0;
            padding-left: 15px;
        }
        
        .message-content li {
            margin: 3px 0;
            font-size: 0.8rem;
        }
        
        .chat-input-container {
            display: flex;
            padding: 10px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .chat-input-container input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .chat-input-container button {
            margin-left: 8px;
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .chat-input-container button:hover {
            background: #2980b9;
        }
        
        .chat-input-container button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        /* Balance Sheet Controls Styles */
        .bs-controls-section {
            margin-top: 8px;
        }
        
        .bs-controls-section h4 {
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 10px;
            padding: 8px;
            background: #e3f2fd;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .bs-control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .bs-control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        
        .bs-control-row label {
            font-size: 0.85rem;
            color: #495057;
            font-weight: 500;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .bs-control-row input {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.85rem;
            text-align: right;
            transition: border-color 0.2s;
        }
        
        .bs-control-row input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .bs-control-row .unit {
            font-size: 0.8rem;
            color: #6c757d;
            min-width: 35px;
        }
        
        .bs-info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 5px;
            margin-right: 5px;
            vertical-align: middle;
            transition: background-color 0.2s;
        }
        
        .bs-info-icon:hover {
            background: #2980b9;
        }
        
        .bs-reset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            width: 100%;
            margin-top: 10px;
            transition: background 0.2s;
        }
        
        .bs-reset-btn:hover {
            background: #5a6268;
        }
        
        /* Collapsible Section Styles */
        .controls.collapsible {
            position: relative;
        }
        
        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            margin-bottom: 0;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .collapsible-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .collapsible-header h3 {
            color: white;
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
        }
        
        .collapse-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            line-height: 1;
        }
        
        .collapsible-header.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1;
            margin-top: 12px;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
        }
        
        /* Pulse animation for hints */
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
        }
        
        .collapsible-header.hint {
            animation: pulse 2s infinite;
        }
        
        /* Floating Chat Bubble */
        .chat-bubble {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: all 0.3s ease;
        }
        
        .chat-bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(17, 153, 142, 0.4);
        }
        
        .chat-bubble.has-notification::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            background: #e74c3c;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        @keyframes chatPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 4px 20px rgba(17, 153, 142, 0.6), 0 0 0 10px rgba(17, 153, 142, 0.1); }
        }
        
        .chat-bubble.pulse {
            animation: chatPulse 2s infinite;
        }
        
        /* Floating Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 380px;
            height: 550px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        
        .chat-widget.open {
            display: flex;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chat-widget-header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-widget-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .chat-minimize-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .chat-minimize-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .chat-widget-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Configuration Tabs Styles */
        .config-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .config-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }
        
        .config-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .config-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .config-tab.active {
            background: white;
            color: #3498db;
        }
        
        .config-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }
        
        .config-tab .tab-icon {
            font-size: 1rem;
        }
        
        .config-tab .tab-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            margin-left: 4px;
        }
        
        .config-content {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .config-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .config-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .config-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .config-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .config-panel {
            display: none;
        }
        
        .config-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .config-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .config-placeholder h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .config-placeholder p {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .config-placeholder .placeholder-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Quick Actions Section */
        .quick-actions {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 2px solid #e9ecef;
        }
        
        .quick-actions h3 {
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .action-row {
            display: flex;
            gap: 12px;
            align-items: stretch;
        }
        
        .action-upload {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .upload-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: none;
        }
        
        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .upload-button input[type="file"] {
            display: none;
        }
        
        .upload-status {
            font-size: 0.8rem;
            color: #6c757d;
            padding-left: 8px;
        }
        
        .upload-status.has-file {
            color: #27ae60;
            font-weight: 600;
        }
        
        .action-run-forecast {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 160px;
        }
        
        .action-run-forecast:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .action-run-forecast:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Insights Container Styles */
        .insights-container {
            height: 500px;
            display: flex;
            flex-direction: column;
            border: 2px solid #27ae60;
            border-radius: 8px;
            background: white;
            padding: 10px;
            overflow-y: auto;
        }
        
        .insights-section {
            margin-bottom: 15px;
        }
        
        .insights-section h4 {
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .insights-list {
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        
        .insight-item {
            padding: 6px 8px;
            margin: 4px 0;
            border-radius: 4px;
            background: #f8f9fa;
            border-left: 3px solid #3498db;
        }
        
        .insight-item.positive {
            border-left-color: #27ae60;
        }
        
        .insight-item.negative {
            border-left-color: #e74c3c;
        }
        
        .insight-item.anomaly {
            border-left-color: #f39c12;
        }
        
        .insight-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .insight-value {
            color: #6c757d;
            font-size: 0.75rem;
        }
        
        .loading {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 10px;
        }
        
        .refresh-insights-btn {
            width: 100%;
            padding: 8px 16px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        .refresh-insights-btn:hover {
            background: #219a52;
        }
        
        /* Insights Dashboard Styles */
        .insights-dashboard {
            padding: 20px 0;
        }
        
        .insights-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        /* Period Selector */
        .period-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .period-btn {
            padding: 8px 20px;
            border: 2px solid #dee2e6;
            background: white;
            color: #495057;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .period-btn:hover {
            border-color: #3498db;
            color: #3498db;
        }
        
        .period-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        /* Insights Content Container */
        .insights-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* At a Glance Section */
        .at-a-glance-section {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .at-a-glance-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .glance-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .glance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .glance-card .card-icon {
            font-size: 2rem;
        }
        
        .glance-card .card-content {
            flex: 1;
        }
        
        .glance-card .card-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .glance-card .card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            line-height: 1.2;
        }
        
        .glance-card .card-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .glance-card .card-change.positive {
            color: #27ae60;
        }
        
        .glance-card .card-change.negative {
            color: #e74c3c;
        }
        
        .glance-card .card-change.neutral {
            color: #95a5a6;
        }
        
        /* Collapsible Insight Sections */
        .insight-section-collapsible {
            margin-bottom: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .insight-section-collapsible .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            transition: background 0.2s;
        }
        
        .insight-section-collapsible .section-header:hover {
            background: #e9ecef;
        }
        
        .insight-section-collapsible .section-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .insight-section-collapsible .toggle-icon {
            font-size: 1.5rem;
            color: #6c757d;
            font-weight: 300;
            width: 30px;
            text-align: center;
        }
        
        .insight-section-collapsible .section-content {
            padding: 20px;
        }
        
        /* Permanent Insight Sections (Charts) */
        .insight-section-permanent {
            margin-bottom: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 20px;
        }
        
        .insight-section-permanent h3 {
            color: #2c3e50;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 20px 0;
        }
        
        .chart-period-section {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .chart-period-section:last-child {
            margin-bottom: 0;
        }
        
        .insights-containers {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .insights-period-container {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .insights-period-container h3 {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .insights-sections {
            padding: 20px;
        }
        
        .insights-sections .insights-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            min-height: 250px;
        }
        
        .insights-sections .insights-section:last-child {
            margin-bottom: 0;
        }
        
        .insights-sections .insights-section h4 {
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .chart-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .chart-control-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid #ccc;
            flex-shrink: 0;
        }
        
        .color-picker-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .color-picker-button {
            width: 24px;
            height: 24px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            background-color: #3498db;
        }
        
        .color-picker-dropdown {
            position: absolute;
            top: 28px;
            left: 0;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            padding: 6px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .color-picker-dropdown.open {
            display: block;
        }
        
        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin: 4px;
            cursor: pointer;
            display: inline-block;
            border: 2px solid transparent;
        }
        
        .color-option:hover {
            border-color: #495057;
        }
        
        .color-option.selected {
            border-color: #000;
            box-shadow: 0 0 0 1px #fff, 0 0 0 3px #000;
        }
        
        .chart-controls select {
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            flex: 1;
            min-width: 0;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .anomaly-controls {
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .anomalous-items-container {
            height: 200px !important;
            max-height: 200px !important;
            overflow-y: scroll !important;
            border: 2px solid #e74c3c !important;
            border-radius: 6px;
            background: #fff5f5 !important;
            margin-top: 10px;
            display: block !important;
            position: relative !important;
            box-sizing: border-box !important;
        }
        
        .anomalous-items-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .anomalous-items-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .anomalous-items-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .anomalous-items-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .anomalous-items-container .insights-list {
            padding: 15px;
            padding-bottom: 25px;
            min-height: 250px;
            display: block;
        }
        
        .anomalous-items-container .insight-item {
            margin-bottom: 8px;
        }
        
        .anomaly-controls .control-item {
            margin: 0;
        }
        
        .anomaly-controls .control-item label {
            font-size: 0.8rem;
            min-width: auto;
        }
        
        .anomaly-controls .control-item input {
            width: 60px;
            padding: 4px 6px;
            font-size: 0.8rem;
        }
        
        .line-chart {
            height: 200px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 10px;
        }
        
        .line-chart svg {
            width: 100%;
            height: 100%;
        }
        
        .btn-expand-chart {
            padding: 6px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-expand-chart:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .chart-date-range {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .line-chart .loading {
            color: #6c757d;
            font-style: italic;
        }
        
        @media (max-width: 1200px) {
            .statements-container {
                grid-template-columns: 1fr;
            }
            
            .insights-containers {
                flex-direction: column;
            }
        }
        
        /* ============================================
           SCENARIOS STYLING
           ============================================ */
        
        /* Scenarios Config Panel */
        .scenarios-config-container {
            padding: 10px 0;
        }
        
        .scenarios-list {
            margin-bottom: 20px;
        }
        
        .scenario-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .scenario-item:hover {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .scenario-item.active {
            background: #e3f2fd;
            border-color: #2196f3;
            font-weight: 600;
        }
        
        .scenario-radio {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .scenario-radio input[type="radio"] {
            cursor: pointer;
        }
        
        .scenario-radio label {
            cursor: pointer;
            flex: 1;
        }
        
        .scenario-name {
            font-size: 1em;
            color: #333;
        }
        
        .scenario-description {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
            font-style: italic;
        }
        
        .scenario-actions {
            display: flex;
            gap: 8px;
        }
        
        .scenario-action-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .scenario-action-btn:hover:not(.disabled) {
            background: rgba(0,0,0,0.1);
        }
        
        .scenario-action-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .scenario-create-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn-create-scenario,
        .btn-load-template {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-create-scenario {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-create-scenario:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-load-template {
            background: #fff;
            border: 2px solid #667eea;
            color: #667eea;
        }
        
        .btn-load-template:hover {
            background: #f5f7ff;
        }
        
        .active-scenario-indicator {
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }
        
        /* Scenarios Comparison Tab */
        .scenarios-comparison-container {
            padding: 20px;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .scenario-selector h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .scenario-comparison-section {
            margin-bottom: 30px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-header h3 {
            color: #333;
        }
        
        .scenario-details-links {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .scenario-details-links h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        /* Sensitivity Analysis Styles */
        .sensitivity-container {
            padding: 20px;
        }
        
        .sensitivity-config {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .sensitivity-config h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .sensitivity-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .form-row {
            margin-bottom: 20px;
        }
        
        .form-row label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .sensitivity-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            width: 100%;
            max-width: 400px;
        }
        
        .form-actions {
            margin-top: 25px;
            display: flex;
            gap: 15px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #3498db;
        }
        
        .sensitivity-results {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
        }
        
        .sensitivity-results h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .sensitivity-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .sensitivity-table-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
        }
        
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
            min-width: 100%;
        }
        
        .sensitivity-table th {
            background: #3498db;
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .sensitivity-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        /* Let columns size naturally based on content */
        .sensitivity-table th:nth-child(1),
        .sensitivity-table td:nth-child(1) {
            width: 12%;
            text-align: left;
        }
        
        .sensitivity-table th:nth-child(2),
        .sensitivity-table td:nth-child(2) {
            width: 35%;
            text-align: right;
        }
        
        .sensitivity-table th:nth-child(3),
        .sensitivity-table td:nth-child(3) {
            width: 35%;
            text-align: right;
        }
        
        .sensitivity-table th:nth-child(4),
        .sensitivity-table td:nth-child(4) {
            width: 18%;
            text-align: right;
        }
        
        .sensitivity-table tr:hover {
            background: #f8f9fa;
        }
        
        .baseline-row {
            background: #fff3cd !important;
            font-weight: 600;
        }
        
        .baseline-row td {
            border-top: 2px solid #ffc107;
            border-bottom: 2px solid #ffc107;
        }
        
        .positive {
            color: #27ae60;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .sensitivity-insights {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .sensitivity-insights h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .sensitivity-insights ul {
            list-style: none;
            padding: 0;
        }
        
        .sensitivity-insights li {
            padding: 8px 0;
            color: #333;
        }
        
        /* Sensitivity Chart */
        .sensitivity-chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .sensitivity-chart-container h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .chart-subtitle {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .line-chart-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
        }
        
        .line-chart-svg {
            width: 100%;
            height: 100%;
        }
        
        .chart-line {
            fill: none;
            stroke: #3498db;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .chart-grid-line {
            stroke: #e0e0e0;
            stroke-width: 1;
            stroke-dasharray: 2,2;
        }
        
        .chart-axis {
            stroke: #666;
            stroke-width: 2;
        }
        
        .chart-point {
            fill: #3498db;
            stroke: white;
            stroke-width: 2;
        }
        
        .chart-point.baseline {
            fill: #f39c12;
            r: 6;
        }
        
        .chart-point:hover {
            r: 8;
            cursor: pointer;
        }
        
        .chart-label-text {
            font-size: 11px;
            fill: #333;
            text-anchor: middle;
            font-weight: 500;
        }
        
        .chart-label-bg {
            stroke: white;
            stroke-width: 4;
            paint-order: stroke;
        }
        
        .chart-value-text {
            font-size: 10px;
            fill: #333;
            font-weight: 600;
        }
        
        .axis-label {
            font-size: 12px;
            fill: #666;
            font-weight: 500;
        }
        
        .chart-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .chart-tooltip.visible {
            opacity: 1;
        }
        
        /* Template Cards */
        .template-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .template-card {
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .template-card:hover {
            background: #fff;
            border-color: #2196f3;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .template-card h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .template-card p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }
        
        /* Modal Buttons */
        .btn-primary,
        .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            margin-right: 10px;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-danger {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .modal-actions {
            border-top: 1px solid #e0e0e0;
            padding-top: 20px;
        }
        
        /* Modal Input Styling */
        .modal input[type="text"],
        .modal textarea,
        .modal select {
            width: 100%;
            padding: 8px 12px;
            margin-top: 5px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            color: #333;
            box-sizing: border-box;
        }
        
        .modal input[type="text"]:focus,
        .modal textarea:focus,
        .modal select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .modal textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        /* Fix modal scrolling for tall content */
        .modal-content {
            max-height: 85vh;
            overflow-y: auto;
            margin: 5% auto;
        }
        
        .modal-body {
            max-height: calc(85vh - 150px);
            overflow-y: auto;
        }
        
        /* Subheader Styles */
        .subheader-row {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="telescope-logo.png" alt="Telescope - Forecast Smarter. See Further." class="logo">
        </div>
        
        
        
        <div class="content">
            <div class="layout">
                <aside class="sidebar" id="sidebar">
                    <!-- Sidebar Toggle -->
                    <div class="sidebar-toggle">
                        <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Collapse sidebar"></button>
                    </div>
                    
                    <!-- Collapsed Sidebar Icon Strip -->
                    <div class="sidebar-collapsed-icons">
                        <div class="sidebar-icon-item" data-tooltip="Model Config" id="collapsedModel" title="Model Configuration"></div>
                        <div class="sidebar-icon-item" data-tooltip="P&L Forecast" id="collapsedPnL" title="P&L Forecast"></div>
                        <div class="sidebar-icon-item" data-tooltip="Balance Sheet" id="collapsedBalance" title="Balance Sheet"></div>
                        <div class="sidebar-icon-item" data-tooltip="Cash Flow" id="collapsedCash" title="Cash Flow"></div>
                        <div class="sidebar-icon-item" data-tooltip="Scenarios" id="collapsedScenarios" title="Scenarios"></div>
                    </div>
                    
                    <div class="sidebar-content">
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3> Quick Actions</h3>
                        <div class="action-row">
                            <div class="action-upload">
                                <label class="upload-button">
                                     Upload Actuals (CSV)
                                    <input type="file" id="actualsFile" accept=".csv">
                                </label>
                                <span class="upload-status" id="uploadStatus">No file selected</span>
                            </div>
                            <button class="action-run-forecast" id="runForecastBtn">
                                 Run Forecasts
                            </button>
                        </div>
                    </div>
                    
                    <!-- Configuration Tabs -->
                    <div class="config-section">
                        <h3 style="padding: 15px 20px; margin: 0; background: #f8f9fa; border-bottom: 2px solid #dee2e6; color: #2c3e50; font-size: 1.1rem; font-weight: 600;">Configurations</h3>
                        <div class="config-tabs">
                            <button class="config-tab active" data-config-tab="model">
                                <span class="tab-icon"></span>
                                <span>Model</span>
                            </button>
                            <button class="config-tab" data-config-tab="pnl">
                                <span class="tab-icon"></span>
                                <span>P&L</span>
                            </button>
                            <button class="config-tab" data-config-tab="balance">
                                <span class="tab-icon"></span>
                                <span>Balance Sheet</span>
                            </button>
                            <button class="config-tab" data-config-tab="cashflow">
                                <span class="tab-icon"></span>
                                <span>Cashflow</span>
                            </button>
                            <button class="config-tab" data-config-tab="scenarios">
                                <span class="tab-icon"></span>
                                <span>Scenarios</span>
                            </button>
                        </div>
                        
                        <div class="config-content">
                            <!-- Model Configuration Panel -->
                            <div class="config-panel active" id="model-config">
                                <div class="control-group">
                                    <div class="control-item">
                                        <label>Forecast Periods (months):</label>
                                        <input type="number" id="forecastPeriods" value="12" min="1" max="60">
                                    </div>
                                </div>
                                <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-top: 20px;">
                                    <div style="font-size: 0.9rem; color: #1976d2;">
                                        <strong> Global Settings:</strong> These settings affect the entire financial model across all three statements (P&L, Balance Sheet, and Cash Flow).
                                    </div>
                                </div>
                            </div>
                            
                            <!-- P&L Forecast Configuration Panel -->
                            <div class="config-panel" id="pnl-config">
                            <div class="control-group">
                                <div class="control-item">
                                    <label>Forecast Method:</label>
                                    <span class="help-button" id="forecastMethodHelp" title="Click for forecast method explanations">?</span>
                                    <select id="forecastMethod">
                                        <option value="custom">Linear Growth</option>
                                        <option value="exponential">Exponential Growth</option>
                                        <option value="logarithmic">Logarithmic Growth</option>
                                        <option value="scurve" style="color: red;">S-Curve Growth (in development)</option>
                                        <option value="rolling">Rolling Average</option>
                                    </select>
                                </div>
                                <div class="control-item">
                                    <label>Annual Growth Rate (%):</label>
                                    <input type="number" id="customGrowthRate" value="5.0" step="0.1" title="Enter annual growth rate (e.g., 5% = 5% per year)" style="width: 80px;">
                                </div>
                                
                                <!-- S-Curve Specific Controls -->
                                <div id="scurve-controls" style="display: none;">
                                    <div class="control-item">
                                        <label>Max Value ($):</label>
                                        <input type="number" id="scurveMaxValue" step="1000" title="Maximum possible value (market ceiling)">
                                    </div>
                                    <div class="control-item">
                                        <label>Midpoint (Month):</label>
                                        <input type="number" id="scurveMidpoint" min="1" max="60" title="Month when growth peaks (inflection point)">
                                    </div>
                                </div>
                                
                                <!-- Seasonality Controls -->
                                <div class="control-item">
                                    <label>Seasonal Pattern:</label>
                                    <span class="help-button" id="seasonalPatternHelp" title="Click for seasonal pattern explanations">?</span>
                                    <select id="seasonalPattern">
                                        <option value="none">No Seasonality</option>
                                        <option value="retail">Retail (Q4 peak)</option>
                                        <option value="saas">SaaS (steady)</option>
                                        <option value="construction">Construction (summer peak)</option>
                                        <option value="custom">Custom Pattern</option>
                                    </select>
                                </div>
                                
                                <!-- Monthly Multipliers Grid (Always visible when seasonality selected) -->
                                <div id="seasonal-multipliers" style="display: none; width: 100%; margin: 15px 0;">
                                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057; font-size: 0.85rem;">Monthly Multipliers:</label>
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-size: 0.75rem;">
                                        <div style="display: flex; align-items: center; gap: 4px;">Jan: <input type="number" id="jan-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Feb: <input type="number" id="feb-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Mar: <input type="number" id="mar-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Apr: <input type="number" id="apr-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">May: <input type="number" id="may-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Jun: <input type="number" id="jun-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Jul: <input type="number" id="jul-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Aug: <input type="number" id="aug-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Sep: <input type="number" id="sep-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Oct: <input type="number" id="oct-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Nov: <input type="number" id="nov-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                        <div style="display: flex; align-items: center; gap: 4px;">Dec: <input type="number" id="dec-mult" value="1.0" step="0.1" min="0" max="2" style="width: 52px; padding: 4px;"></div>
                                    </div>
                                </div>
                                
                                <div class="control-item">
                                    <label>Seasonal Strength:</label>
                                    <input type="range" id="seasonalStrength" min="0" max="100" value="50" style="width: 120px;">
                                    <span id="seasonalStrengthValue">50%</span>
                                </div>
                                
                                <!-- Operating Leverage Toggle -->
                                <div class="control-item" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center;">
                                    <label style="margin: 0;">
                                        Apply Operating Leverage (80% Rule)
                                        <span class="help-button" id="operatingLeverageHelp" title="Click for explanation of the 80% rule">?</span>
                                    </label>
                                    <input type="checkbox" id="applyOperatingLeverage" checked style="width: auto;">
                                </div>
                                
                                <!-- Custom Independent Growth Rates -->
                                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                                        <h4 style="margin: 0; font-size: 1rem; color: #2c3e50;"> Custom Independent Growth Rates</h4>
                                        <span class="help-button" id="customRatesHelp" title="Click for help on custom growth rates">?</span>
                                    </div>
                                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                                        Override the global growth rate for specific line items. Custom rates ignore the 80% rule.
                                    </div>
                                    
                                    <div id="customRatesList" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
                                        <!-- Custom rates will be added here dynamically -->
                                    </div>
                                    
                                    <div class="control-group" style="margin: 0;">
                                        <div class="control-item">
                                            <label>Select Line Item:</label>
                                            <select id="addCustomRateDropdown">
                                                <option value="">+ Add Line Item</option>
                                            </select>
                                        </div>
                                        <div class="control-item">
                                            <label>Annual Growth Rate (%):</label>
                                            <input type="number" id="customRateInput" placeholder="e.g., 8.5" step="0.1" disabled>
                                        </div>
                                        <div class="control-item" style="align-items: flex-end;">
                                            <button id="addCustomRateBtn" class="btn-secondary" disabled>Add Custom Rate</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                            
                            <!-- Balance Sheet Configuration Panel -->
                            <div class="config-panel" id="balance-config">
                        
                        <div class="bs-controls-section">
                            <h4>Working Capital</h4>
                            <div class="bs-control-group">
                                <div class="bs-control-row">
                                    <label>
                                        <span>DSO</span>
                                        <span class="bs-info-icon" title="Days Sales Outstanding - Average time to collect payment from customers">?</span>
                                    </label>
                                    <input type="number" id="bsDSO" value="30" min="0" max="365" step="1">
                                    <span class="unit">days</span>
                                </div>
                                <div class="bs-control-row">
                                    <label>
                                        <span>DPO</span>
                                        <span class="bs-info-icon" title="Days Payable Outstanding - Average time to pay suppliers">?</span>
                                    </label>
                                    <input type="number" id="bsDPO" value="30" min="0" max="365" step="1">
                                    <span class="unit">days</span>
                                </div>
                                <div class="bs-control-row">
                                    <label>
                                        <span>DIO</span>
                                        <span class="bs-info-icon" title="Days Inventory Outstanding - Average time inventory sits before being sold">?</span>
                                    </label>
                                    <input type="number" id="bsDIO" value="45" min="0" max="365" step="1">
                                    <span class="unit">days</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bs-controls-section">
                            <h4>Fixed Assets</h4>
                            <div class="bs-control-group">
                                <div class="bs-control-row">
                                    <label>
                                        <span>Depreciation Rate (annual)</span>
                                        <span class="bs-info-icon" title="Annual depreciation rate for Property, Plant & Equipment">?</span>
                                    </label>
                                    <input type="number" id="bsDepreciationRate" value="10" min="0" max="100" step="0.5">
                                    <span class="unit">%</span>
                                </div>
                                <div class="bs-control-row">
                                    <label>
                                        <span>CapEx % of Revenue (annual)</span>
                                        <span class="bs-info-icon" title="Capital Expenditures as percentage of annual revenue - new investments in fixed assets">?</span>
                                    </label>
                                    <input type="number" id="bsCapexPercentage" value="3" min="0" max="100" step="0.5">
                                    <span class="unit">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bs-controls-section">
                            <h4>Policies</h4>
                            <div class="bs-control-group">
                                <div class="bs-control-row">
                                    <label>
                                        <span>Dividend Policy</span>
                                        <span class="bs-info-icon" title="Dividends paid as percentage of net income">?</span>
                                    </label>
                                    <input type="number" id="bsDividendPolicy" value="0" min="0" max="100" step="1">
                                    <span class="unit">%</span>
                                </div>
                                <div class="bs-control-row">
                                    <label>
                                        <span>Cash Target</span>
                                        <span class="bs-info-icon" title="Minimum cash buffer in days of operating expenses">?</span>
                                    </label>
                                    <input type="number" id="bsCashTarget" value="30" min="0" max="365" step="1">
                                    <span class="unit">days</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bs-controls-section">
                            <h4>Accruals</h4>
                            <div class="bs-control-group">
                                <div class="bs-control-row">
                                    <label>
                                        <span>Accrued Expenses</span>
                                        <span class="bs-info-icon" title="Accrued expenses as percentage of total expenses">?</span>
                                    </label>
                                    <input type="number" id="bsAccruedExpenses" value="5" min="0" max="100" step="0.5">
                                    <span class="unit">%</span>
                                </div>
                                <div class="bs-control-row">
                                    <label>
                                        <span>Prepaid Expenses</span>
                                        <span class="bs-info-icon" title="Prepaid expenses as percentage of revenue">?</span>
                                    </label>
                                    <input type="number" id="bsPrepaidExpenses" value="1" min="0" max="100" step="0.5">
                                    <span class="unit">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="bs-reset-btn" id="bsResetBtn">Reset to Defaults</button>
                            </div>
                            
                            <!-- Cash Flow Configuration Panel (Placeholder) -->
                            <div class="config-panel" id="cashflow-config">
                                <div class="config-placeholder">
                                    <div class="placeholder-icon"></div>
                                    <h4>Cash Flow Statement Configuration</h4>
                                    <p>Configure cash flow forecasting assumptions and methods.</p>
                                    <p style="margin-top: 15px; font-style: italic;">Coming soon! This will include:</p>
                                    <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                                        <li>Operating activities adjustments</li>
                                        <li>Investing activities (CapEx, acquisitions)</li>
                                        <li>Financing activities (debt, equity, dividends)</li>
                                        <li>Cash reconciliation methods</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Scenarios Configuration Panel -->
                            <div class="config-panel" id="scenarios-config">
                                <div class="scenarios-config-container">
                                    <h4 style="margin-bottom: 15px; color: #333;"> Your Scenarios</h4>
                                    <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">
                                        Create and manage different forecast scenarios. Switch between scenarios to model different futures.
                                    </p>
                                    
                                    <!-- Scenarios list will be populated dynamically -->
                                    <div id="scenarios-list-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div><!-- End sidebar-content -->
                    
                </aside>
                <div class="main">
                    <div class="tabs">
                        <button class="tab" data-tab="insights">Insights Dashboard</button>
                        <button class="tab active" data-tab="monthly">Monthly Forecast</button>
                        <button class="tab" data-tab="quarterly">Quarterly Forecast</button>
                        <button class="tab" data-tab="yearly">Yearly Forecast</button>
                        <button class="tab" data-tab="scenarios">Scenarios</button>
                        <button class="tab" data-tab="sensitivity">Sensitivity</button>
                    </div>
                    
                
                    
            
            <div id="insights" class="tab-content">
                <div class="forecast-info">
                    <strong>Insights Dashboard</strong> - Financial insights across all date ranges
                </div>
                <div class="insights-dashboard">
                    <!-- Period Selector -->
                    <div class="insights-controls">
                        <div class="period-selector">
                            <label style="font-weight: 600; margin-right: 15px;">View Period:</label>
                            <button class="period-btn active" data-period="monthly" onclick="switchInsightsPeriod('monthly')">Monthly</button>
                            <button class="period-btn" data-period="quarterly" onclick="switchInsightsPeriod('quarterly')">Quarterly</button>
                            <button class="period-btn" data-period="yearly" onclick="switchInsightsPeriod('yearly')">Yearly</button>
                        </div>
                        <button class="refresh-insights-btn" id="refreshInsightsBtn" onclick="refreshAllInsights()">Refresh All Insights</button>
                    </div>

                    <!-- Main Insights Content (Period-Specific) -->
                    <div class="insights-content">
                        
                        <!-- At a Glance Section (Always Visible) -->
                        <div class="at-a-glance-section">
                            <div class="at-a-glance-cards" id="atAGlanceCards">
                                <div class="glance-card">
                                    <div class="card-icon"></div>
                                    <div class="card-content">
                                        <div class="card-label">Revenue</div>
                                        <div class="card-value" id="glanceRevenue">--</div>
                                        <div class="card-change" id="glanceRevenueChange">--</div>
                                    </div>
                                </div>
                                <div class="glance-card">
                                    <div class="card-icon"></div>
                                    <div class="card-content">
                                        <div class="card-label">Net Margin</div>
                                        <div class="card-value" id="glanceMargin">--</div>
                                        <div class="card-change" id="glanceMarginChange">--</div>
                                    </div>
                                </div>
                                <div class="glance-card">
                                    <div class="card-icon"></div>
                                    <div class="card-content">
                                        <div class="card-label">Growth</div>
                                        <div class="card-value" id="glanceGrowth">--</div>
                                        <div class="card-change" id="glanceGrowthChange">--</div>
                                    </div>
                                </div>
                                <div class="glance-card">
                                    <div class="card-icon"></div>
                                    <div class="card-content">
                                        <div class="card-label">Net Income</div>
                                        <div class="card-value" id="glanceCash">--</div>
                                        <div class="card-change" id="glanceCashChange">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Forecast Reality Check Section -->
                        <div class="insight-section-collapsible">
                            <div class="section-header" onclick="toggleInsightSection('realitycheck')">
                                <h3> Forecast Reality Check</h3>
                                <span class="toggle-icon"></span>
                            </div>
                            <div class="section-content" id="realitycheckContent">
                                <div class="loading">Comparing forecast to historical baseline...</div>
                            </div>
                        </div>

                        <!-- Margin Forecast Section -->
                        <div class="insight-section-collapsible collapsed">
                            <div class="section-header" onclick="toggleInsightSection('margins')">
                                <h3> Margin Forecast</h3>
                                <span class="toggle-icon">+</span>
                            </div>
                            <div class="section-content" id="marginsContent" style="display: none;">
                                <div class="loading">Calculating margin forecast...</div>
                            </div>
                        </div>

                        <!-- Expense vs Revenue Growth Section -->
                        <div class="insight-section-collapsible collapsed">
                            <div class="section-header" onclick="toggleInsightSection('expenses')">
                                <h3> Expense vs Revenue Growth</h3>
                                <span class="toggle-icon">+</span>
                            </div>
                            <div class="section-content" id="expensesContent" style="display: none;">
                                <div class="loading">Analyzing expense forecast...</div>
                            </div>
                        </div>

                        <!-- Forecast Alerts Section -->
                        <div class="insight-section-collapsible" id="alertsSection">
                            <div class="section-header" onclick="toggleInsightSection('alerts')">
                                <h3> Forecast Alerts</h3>
                                <span class="toggle-icon"></span>
                            </div>
                            <div class="section-content" id="alertsContent">
                                <div class="loading">Checking forecast assumptions...</div>
                            </div>
                        </div>

                        <!-- Interactive Charts Section (All 3 Periods - Always Visible) -->
                        <div class="insight-section-permanent">
                            <h3 style="margin-bottom: 20px;"> Interactive Charts</h3>
                            
                            <!-- Monthly Chart -->
                            <div class="chart-period-section">
                                <h4 style="padding: 10px 15px; margin: 0; background: #f8f9fa; border-left: 4px solid #3498db;">Monthly Chart</h4>
                                <div style="padding: 15px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div></div>
                                        <button class="btn-expand-chart" onclick="expandChart('monthly')" title="Expand chart"> Expand</button>
                                    </div>
                                    <div class="chart-controls">
                                        <div class="chart-control-item">
                                            <div class="color-picker-wrapper">
                                                <div class="color-picker-button" id="monthlyLineColor1" data-color="#3498db" style="background-color: #3498db;"></div>
                                                <div class="color-picker-dropdown">
                                                    <div class="color-option selected" data-color="#3498db" style="background-color: #3498db;"></div>
                                                    <div class="color-option" data-color="#e74c3c" style="background-color: #e74c3c;"></div>
                                                    <div class="color-option" data-color="#27ae60" style="background-color: #27ae60;"></div>
                                                    <div class="color-option" data-color="#000000" style="background-color: #000000;"></div>
                                                    <div class="color-option" data-color="#9b59b6" style="background-color: #9b59b6;"></div>
                                                    <div class="color-option" data-color="#e91e63" style="background-color: #e91e63;"></div>
                                                    <div class="color-option" data-color="#f39c12" style="background-color: #f39c12;"></div>
                                                    <div class="color-option" data-color="#f1c40f" style="background-color: #f1c40f;"></div>
                                                    <div class="color-option" data-color="#34495e" style="background-color: #34495e;"></div>
                                                    <div class="color-option" data-color="#95a5a6" style="background-color: #95a5a6;"></div>
                                                    <div class="color-option" data-color="#1abc9c" style="background-color: #1abc9c;"></div>
                                                </div>
                                            </div>
                                            <select id="monthlyLineItem1">
                                                <option value="">Select line item 1</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="monthlyLineColor2" class="color-picker-select" style="background-color: #e74c3c;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;" selected></option>
                                                <option value="#27ae60" style="color: #27ae60;"></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="monthlyLineItem2">
                                                <option value="">Select line item 2</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="monthlyLineColor3" class="color-picker-select" style="background-color: #27ae60;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;"></option>
                                                <option value="#27ae60" style="color: #27ae60;" selected></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="monthlyLineItem3">
                                                <option value="">Select line item 3</option>
                                            </select>
                                        </div>
                                        <div class="chart-date-range">
                                            <label style="font-size: 0.85em; color: #666;">Date Range:</label>
                                            <div style="display: flex; gap: 8px; align-items: center;">
                                                <select id="monthlyChartStartPeriod" style="padding: 4px 8px;">
                                                    <option value="">All periods</option>
                                                </select>
                                                <span>to</span>
                                                <select id="monthlyChartEndPeriod" style="padding: 4px 8px;">
                                                    <option value="">End</option>
                                                </select>
                                                <button class="btn-secondary" onclick="updateChart('monthly')" style="padding: 4px 12px; font-size: 0.85em;">Update</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="monthlyLineChart" class="line-chart">
                                        <div class="loading">Select line items to display chart</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quarterly Chart -->
                            <div class="chart-period-section">
                                <h4 style="padding: 10px 15px; margin: 0; background: #f8f9fa; border-left: 4px solid #e74c3c;">Quarterly Chart</h4>
                                <div style="padding: 15px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div></div>
                                        <button class="btn-expand-chart" onclick="expandChart('quarterly')" title="Expand chart"> Expand</button>
                                    </div>
                                    <div class="chart-controls">
                                        <div class="chart-control-item">
                                            <select id="quarterlyLineColor1" class="color-picker-select" style="background-color: #3498db;">
                                                <option value="#3498db" style="color: #3498db;" selected></option>
                                                <option value="#e74c3c" style="color: #e74c3c;"></option>
                                                <option value="#27ae60" style="color: #27ae60;"></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="quarterlyLineItem1">
                                                <option value="">Select line item 1</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="quarterlyLineColor2" class="color-picker-select" style="background-color: #e74c3c;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;" selected></option>
                                                <option value="#27ae60" style="color: #27ae60;"></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="quarterlyLineItem2">
                                                <option value="">Select line item 2</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="quarterlyLineColor3" class="color-picker-select" style="background-color: #27ae60;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;"></option>
                                                <option value="#27ae60" style="color: #27ae60;" selected></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="quarterlyLineItem3">
                                                <option value="">Select line item 3</option>
                                            </select>
                                        </div>
                                        <div class="chart-date-range">
                                            <label style="font-size: 0.85em; color: #666;">Date Range:</label>
                                            <div style="display: flex; gap: 8px; align-items: center;">
                                                <select id="quarterlyChartStartPeriod" style="padding: 4px 8px;">
                                                    <option value="">All periods</option>
                                                </select>
                                                <span>to</span>
                                                <select id="quarterlyChartEndPeriod" style="padding: 4px 8px;">
                                                    <option value="">End</option>
                                                </select>
                                                <button class="btn-secondary" onclick="updateChart('quarterly')" style="padding: 4px 12px; font-size: 0.85em;">Update</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="quarterlyLineChart" class="line-chart">
                                        <div class="loading">Select line items to display chart</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Yearly Chart -->
                            <div class="chart-period-section">
                                <h4 style="padding: 10px 15px; margin: 0; background: #f8f9fa; border-left: 4px solid #27ae60;">Yearly Chart</h4>
                                <div style="padding: 15px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div></div>
                                        <button class="btn-expand-chart" onclick="expandChart('yearly')" title="Expand chart"> Expand</button>
                                    </div>
                                    <div class="chart-controls">
                                        <div class="chart-control-item">
                                            <select id="yearlyLineColor1" class="color-picker-select" style="background-color: #3498db;">
                                                <option value="#3498db" style="color: #3498db;" selected></option>
                                                <option value="#e74c3c" style="color: #e74c3c;"></option>
                                                <option value="#27ae60" style="color: #27ae60;"></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="yearlyLineItem1">
                                                <option value="">Select line item 1</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="yearlyLineColor2" class="color-picker-select" style="background-color: #e74c3c;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;" selected></option>
                                                <option value="#27ae60" style="color: #27ae60;"></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="yearlyLineItem2">
                                                <option value="">Select line item 2</option>
                                            </select>
                                        </div>
                                        <div class="chart-control-item">
                                            <select id="yearlyLineColor3" class="color-picker-select" style="background-color: #27ae60;">
                                                <option value="#3498db" style="color: #3498db;"></option>
                                                <option value="#e74c3c" style="color: #e74c3c;"></option>
                                                <option value="#27ae60" style="color: #27ae60;" selected></option>
                                                <option value="#000000" style="color: #000000;"></option>
                                                <option value="#9b59b6" style="color: #9b59b6;"></option>
                                                <option value="#e91e63" style="color: #e91e63;"></option>
                                                <option value="#f39c12" style="color: #f39c12;"></option>
                                                <option value="#f1c40f" style="color: #f1c40f;"></option>
                                                <option value="#34495e" style="color: #34495e;"></option>
                                                <option value="#95a5a6" style="color: #95a5a6;"></option>
                                                <option value="#1abc9c" style="color: #1abc9c;"></option>
                                            </select>
                                            <select id="yearlyLineItem3">
                                                <option value="">Select line item 3</option>
                                            </select>
                                        </div>
                                        <div class="chart-date-range">
                                            <label style="font-size: 0.85em; color: #666;">Date Range:</label>
                                            <div style="display: flex; gap: 8px; align-items: center;">
                                                <select id="yearlyChartStartPeriod" style="padding: 4px 8px;">
                                                    <option value="">All periods</option>
                                                </select>
                                                <span>to</span>
                                                <select id="yearlyChartEndPeriod" style="padding: 4px 8px;">
                                                    <option value="">End</option>
                                                </select>
                                                <button class="btn-secondary" onclick="updateChart('yearly')" style="padding: 4px 12px; font-size: 0.85em;">Update</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="yearlyLineChart" class="line-chart">
                                        <div class="loading">Select line items to display chart</div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            
            <div id="monthly" class="tab-content active">
                <div class="forecast-info">
                    <strong>Monthly Forecast</strong> - All three statements with monthly periods
                </div>
                <button class="export-btn" onclick="exportPeriodData('monthly')">Export Monthly Forecast</button>
                <div class="statements-container">
                <div id="monthlyPnlContainer" class="independent-table-container"></div>
                <div id="monthlyBalanceContainer" class="independent-table-container"></div>
                <div id="monthlyCashflowContainer" class="independent-table-container"></div>
                </div>
            </div>
            
            <div id="quarterly" class="tab-content">
                <div class="forecast-info">
                    <strong>Quarterly Forecast</strong> - All three statements with quarterly periods
                </div>
                <button class="export-btn" onclick="exportPeriodData('quarterly')">Export Quarterly Forecast</button>
                <div class="statements-container">
                <div id="quarterlyPnlContainer" class="independent-table-container"></div>
                <div id="quarterlyBalanceContainer" class="independent-table-container"></div>
                <div id="quarterlyCashflowContainer" class="independent-table-container"></div>
                </div>
            </div>
            
            <div id="yearly" class="tab-content">
                <div class="forecast-info">
                    <strong>Yearly Forecast</strong> - All three statements with yearly periods
                </div>
                <button class="export-btn" onclick="exportPeriodData('yearly')">Export Yearly Forecast</button>
                <div class="statements-container">
                <div id="yearlyPnlContainer" class="independent-table-container"></div>
                <div id="yearlyBalanceContainer" class="independent-table-container"></div>
                <div id="yearlyCashflowContainer" class="independent-table-container"></div>
                </div>
            </div>
            
            <!-- Scenarios Comparison Tab -->
            <div id="scenarios" class="tab-content">
                <div class="forecast-info">
                    <strong>Scenarios Comparison</strong> - Compare multiple forecast scenarios side-by-side
                </div>
                
                <div class="scenarios-comparison-container">
                    <!-- Scenario selection -->
                    <div class="scenario-selector">
                        <h3>Select Scenarios to Compare:</h3>
                        <div id="scenario-comparison-checkboxes"></div>
                    </div>
                    
                    <!-- Comparison table -->
                    <div class="scenario-comparison-section">
                        <div class="section-header">
                            <h3> Year 1 Key Metrics</h3>
                            <button class="export-btn" onclick="exportAllScenarios()"> Export All Scenarios</button>
                        </div>
                        <div id="scenarios-comparison-table"></div>
                    </div>
                    
                    <!-- Individual scenario links -->
                    <div class="scenario-details-links">
                        <h4>View Full Forecast:</h4>
                        <div id="scenario-forecast-links"></div>
                    </div>
                </div>
            </div>
            
            <!-- Sensitivity Analysis Tab -->
            <div id="sensitivity" class="tab-content">
                <div class="forecast-info">
                    <strong>Sensitivity Analysis</strong> - Test how changes in assumptions affect your forecast
                </div>
                
                <div class="sensitivity-container">
                    <!-- Configuration Section -->
                    <div class="sensitivity-config">
                        <h3> Configure Analysis</h3>
                        <p style="color: #666; margin-bottom: 20px;">See how changes to a single variable impact your forecasted results.</p>
                        
                        <div class="sensitivity-form">
                            <div class="form-row">
                                <label for="sensitivityVariable">Test Variable:</label>
                                <select id="sensitivityVariable" class="sensitivity-input">
                                    <option value="">-- Select a line item to test --</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label>Test Range:</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <span>From:</span>
                                    <input type="number" id="sensitivityMin" class="sensitivity-input" value="-10" step="5" style="width: 80px;">
                                    <span>%</span>
                                    <span style="margin-left: 10px;">To:</span>
                                    <input type="number" id="sensitivityMax" class="sensitivity-input" value="30" step="5" style="width: 80px;">
                                    <span>%</span>
                                    <span style="margin-left: 10px;">Step:</span>
                                    <input type="number" id="sensitivityStep" class="sensitivity-input" value="5" min="1" max="20" step="1" style="width: 70px;">
                                    <span>%</span>
                                </div>
                                <small style="color: #666; margin-top: 5px; display: block;">Current base case growth will be highlighted in results</small>
                            </div>
                            
                            <div class="form-row">
                                <label for="sensitivityOutputMetric">Output Metric:</label>
                                <select id="sensitivityOutputMetric" class="sensitivity-input">
                                    <option value="">-- Select metric to measure --</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label for="sensitivityPeriod">Time Period:</label>
                                <select id="sensitivityPeriod" class="sensitivity-input">
                                    <option value="">-- Select period to analyze --</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button onclick="runSensitivityAnalysis()" class="btn-primary" style="padding: 12px 24px; font-size: 1rem;">
                                     Run Sensitivity Analysis
                                </button>
                                <button onclick="resetSensitivityForm()" class="btn-secondary" style="padding: 12px 24px; font-size: 1rem;">
                                     Reset
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Section (initially hidden) -->
                    <div id="sensitivityResults" class="sensitivity-results" style="display: none;">
                        <h3> Analysis Results</h3>
                        <div id="sensitivityResultsInfo" class="sensitivity-info"></div>
                        
                        <div class="sensitivity-table-container">
                            <table id="sensitivityTable" class="sensitivity-table">
                                <!-- Results will be populated here -->
                            </table>
                        </div>
                        
                        <div id="sensitivityChart" class="sensitivity-chart-container">
                            <!-- Chart will be populated here -->
                        </div>
                        
                        <div id="sensitivityInsights" class="sensitivity-insights">
                            <!-- Insights will be populated here -->
                        </div>
                        
                        <div class="form-actions" style="margin-top: 20px;">
                            <button onclick="exportSensitivityCSV()" class="btn-secondary">
                                 Export to CSV
                            </button>
                            <button onclick="showSensitivityConfig()" class="btn-secondary">
                                 Back to Configuration
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Forecast Method Help Modal -->
    <div id="forecastMethodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Forecast Method Explanations</h3>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <div class="method-explanation">
                <strong>Linear Growth:</strong> Constant dollar growth each period - best for steady, predictable businesses with consistent performance.
            </div>
            <div class="method-explanation">
                <strong>Exponential Growth:</strong> Percentage-based growth that compounds over time - ideal for high-growth startups or expanding markets.
            </div>
            <div class="method-explanation">
                <strong>Logarithmic Growth:</strong> Growth that starts fast then slows down - perfect for businesses reaching market saturation or maturity.
            </div>
            <div class="method-explanation">
                <strong>S-Curve Growth:</strong> Slow start, rapid growth, then plateau - excellent for new products, market penetration, or adoption curves.
            </div>
            <div class="method-explanation">
                <strong>Rolling Average:</strong> Based on historical average plus growth - great for cyclical businesses or when you want to smooth out volatility.
            </div>
        </div>
    </div>

    <!-- Balance Sheet Help Modal -->
    <div id="balanceSheetHelpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Balance Sheet Assumptions Explained</h3>
                <span class="close" id="closeBSModal">&times;</span>
            </div>
            <div class="method-explanation">
                <strong>DSO (Days Sales Outstanding):</strong> Average number of days it takes to collect payment from customers after a sale. Lower is better for cash flow. Typical range: 30-60 days.
            </div>
            <div class="method-explanation">
                <strong>DPO (Days Payable Outstanding):</strong> Average number of days you take to pay suppliers. Higher means you hold onto cash longer. Typical range: 30-45 days.
            </div>
            <div class="method-explanation">
                <strong>DIO (Days Inventory Outstanding):</strong> Average number of days inventory sits before being sold. Lower is better (less cash tied up). Typical range: 30-90 days depending on industry.
            </div>
            <div class="method-explanation">
                <strong>Depreciation Rate (annual):</strong> Annual percentage rate at which fixed assets lose value. Used to calculate depreciation expense and PPE. Typical range: 5-20% depending on asset type.
            </div>
            <div class="method-explanation">
                <strong>CapEx % of Revenue (annual):</strong> Capital expenditures (investments in fixed assets) as a percentage of annual revenue. Reflects growth and maintenance needs. Typical range: 2-10%.
            </div>
            <div class="method-explanation">
                <strong>Dividend Policy:</strong> Percentage of net income paid to shareholders as dividends. Affects retained earnings and cash flow. Typical range: 0-50% (growth companies often pay 0%).
            </div>
            <div class="method-explanation">
                <strong>Cash Target:</strong> Minimum cash buffer measured in days of operating expenses. Used for cash management and balancing. Typical range: 15-60 days.
            </div>
            <div class="method-explanation">
                <strong>Accrued Expenses:</strong> Expenses incurred but not yet paid, as percentage of total expenses. Affects liabilities and cash flow timing. Typical range: 3-10%.
            </div>
            <div class="method-explanation">
                <strong>Prepaid Expenses:</strong> Expenses paid in advance, as percentage of revenue. Affects assets and cash flow timing. Typical range: 0.5-3%.
            </div>
        </div>
    </div>

    <!-- Seasonal Pattern Help Modal -->
    <div id="seasonalPatternModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Seasonal Pattern Explanations</h3>
                <span class="close" id="closeSeasonalModal">&times;</span>
            </div>
            <div class="method-explanation">
                <strong>No Seasonality:</strong> Consistent performance year-round - perfect for subscription services, utilities, or businesses with steady demand.
            </div>
            <div class="method-explanation">
                <strong>Retail (Q4 Peak):</strong> Major holiday spikes in Nov/Dec, dips in Jan/Feb - ideal for e-commerce, retail stores, gift businesses, and consumer goods.
            </div>
            <div class="method-explanation">
                <strong>SaaS (Steady):</strong> Minimal seasonal variation - perfect for software subscriptions, cloud services, and recurring revenue businesses.
            </div>
            <div class="method-explanation">
                <strong>Construction (Summer Peak):</strong> Peak activity in Jun/Aug, low periods in winter months - great for construction, landscaping, outdoor services, and seasonal contractors.
            </div>
            <div class="method-explanation">
                <strong>Custom Pattern:</strong> Define your own monthly multipliers - use this for unique business cycles, event-driven businesses, or when you have specific seasonal data.
            </div>
        </div>
    </div>

    <!-- Operating Leverage (80% Rule) Help Modal -->
    <div id="operatingLeverageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Operating Leverage (80% Rule) Explained</h3>
                <span class="close" id="closeOperatingLeverageModal">&times;</span>
            </div>
            <div class="method-explanation" style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <strong> What is the 80% Rule?</strong><br>
                When enabled, expense items automatically grow at <strong>80% of the revenue growth rate</strong>. This reflects the concept of <em>operating leverage</em> in financial modeling.
            </div>
            <div class="method-explanation">
                <strong> Why does this exist?</strong><br>
                As companies scale, revenue typically grows faster than costs due to:
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Fixed costs</strong> stay flat (rent doesn't double when revenue doubles)</li>
                    <li><strong>Economies of scale</strong> make operations more efficient</li>
                    <li><strong>Automation & leverage</strong> reduce per-unit costs</li>
                </ul>
                This leads to <strong>expanding profit margins</strong> over time, which is a key driver of business value.
            </div>
            <div class="method-explanation">
                <strong> Example:</strong><br>
                If global growth rate = <strong>5%/year</strong>:
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Revenue items</strong> (Revenue, Sales, Income)  grow at <span style="color: #2196f3; font-weight: 600;">5%</span></li>
                    <li><strong>Expense items</strong> (COGS, OpEx, etc.)  grow at <span style="color: #ff9800; font-weight: 600;">4%</span> (80% of 5%)</li>
                </ul>
            </div>
            <div class="method-explanation">
                <strong> When to disable:</strong><br>
                Turn off this rule if:
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>You want precise 1:1 control over all growth rates</li>
                    <li>Your expenses scale linearly with revenue (no leverage)</li>
                    <li>You're modeling a mature, stable business with flat margins</li>
                </ul>
            </div>
            <div style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107; font-size: 0.9em;">
                <strong> Note:</strong> Custom growth rates always use the <strong>exact rate you enter</strong> and ignore the 80% rule.
            </div>
        </div>
    </div>

    <!-- Custom Growth Rates Help Modal -->
    <div id="customRatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Custom Independent Growth Rates</h3>
                <span class="close" id="closeCustomRatesModal">&times;</span>
            </div>
            <div class="method-explanation" style="background: #e8f5e9; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <strong> What are custom growth rates?</strong><br>
                Override the global growth rate for specific line items that need unique forecasting assumptions.
            </div>
            <div class="method-explanation">
                <strong> How it works:</strong><br>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>Select any P&L line item from the dropdown</li>
                    <li>Enter a custom annual growth rate (e.g., 8%)</li>
                    <li>The item will use the <strong>global forecast method</strong> (exponential, linear, etc.) but with <strong>your custom rate</strong></li>
                    <li>Custom rates <strong>ignore the 80% rule</strong> - you get exactly what you enter</li>
                    <li>Seasonality still applies normally</li>
                </ul>
            </div>
            <div class="method-explanation">
                <strong> Common use cases:</strong><br>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Fast-growing product line:</strong> Set Revenue Product A to 15% while overall revenue is 5%</li>
                    <li><strong>Declining expenses:</strong> Set Software Costs to -3% (reduction)</li>
                    <li><strong>Flat forecast:</strong> Set Rent to 0% (no growth)</li>
                    <li><strong>Different cost structures:</strong> Set COGS to 3% while OpEx uses global 5%</li>
                </ul>
            </div>
            <div class="method-explanation" style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                <strong> Restrictions:</strong><br>
                Some balance sheet items (like Accounts Receivable, Inventory) <strong>cannot</strong> have custom rates because they're calculated from P&L formulas (Revenue  DSO, COGS  DIO, etc.).
            </div>
            <div style="background: #e3f2fd; padding: 12px; border-radius: 6px; font-size: 0.9em; margin-top: 15px;">
                <strong> Tip:</strong> Items with custom rates show a <strong> gear icon</strong> in the table. Hover to see the rate!
            </div>
        </div>
    </div>

    <!-- Floating Chat Bubble -->
    <div class="chat-bubble" id="chatBubble" title="Open Financial Assistant">
        
    </div>
    
    <!-- Floating Chat Widget -->
    <div class="chat-widget" id="chatWidget">
        <div class="chat-widget-header">
            <h3> Financial Assistant</h3>
            <button class="chat-minimize-btn" id="chatMinimizeBtn" title="Minimize"></button>
        </div>
        <div class="chat-widget-body">
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message assistant">
                    <div class="message-content">
                         Hi! I'm your financial assistant. I can help you:
                        <ul>
                            <li>Understand your forecast settings</li>
                            <li>Analyze financial trends and patterns</li>
                            <li>Explain balance sheet calculations</li>
                            <li>Answer questions about your data</li>
                        </ul>
                        <strong>Tip:</strong> Use the configuration tabs to adjust your forecasts!
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Ask me anything about your financials..." />
                <button id="sendChatBtn">Send</button>
            </div>
        </div>
    </div>

    <!-- Create Scenario Modal -->
    <div id="create-scenario-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Create New Scenario</h3>
                <span class="close-modal" onclick="closeModal('create-scenario-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-scenario-name">Scenario Name:</label>
                    <input type="text" id="new-scenario-name" placeholder="e.g., Q4 Product Launch">
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label for="new-scenario-description">Description (optional):</label>
                    <textarea id="new-scenario-description" rows="3" placeholder="Brief description of this scenario..."></textarea>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>Start from:</label>
                    <div style="margin-top: 10px;">
                        <div style="margin-bottom: 8px;">
                            <input type="radio" id="scenario-source-current" name="scenario-source" value="current" checked>
                            <label for="scenario-source-current">Current settings</label>
                            <span style="font-size: 0.85em; color: #666; margin-left: 8px;">(Use active scenario's assumptions)</span>
                        </div>
                        <div style="margin-top: 8px; display: flex; align-items: center; gap: 10px;">
                            <input type="radio" id="scenario-source-template" name="scenario-source" value="template">
                            <label for="scenario-source-template" style="margin: 0; min-width: 100px;">Template:</label>
                            <select id="scenario-template-select" style="flex: 1; max-width: 250px;">
                                <option value="best-case">Best Case</option>
                                <option value="worst-case">Worst Case</option>
                                <option value="high-growth">High Growth</option>
                                <option value="cash-conservation">Cash Conservation</option>
                                <option value="recession">Recession</option>
                            </select>
                        </div>
                        <div style="margin-top: 8px; display: flex; align-items: center; gap: 10px;">
                            <input type="radio" id="scenario-source-copy" name="scenario-source" value="copy">
                            <label for="scenario-source-copy" style="margin: 0; min-width: 100px;">Copy existing:</label>
                            <select id="scenario-copy-select" style="flex: 1; max-width: 250px;">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 0.85em; color: #666;">
                             <strong>Tip:</strong> "Copy existing" lets you duplicate a scenario you already created and customized.
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions" style="margin-top: 25px; text-align: right;">
                    <button class="btn-secondary" onclick="closeModal('create-scenario-modal')">Cancel</button>
                    <button class="btn-primary" onclick="handleCreateScenario()">Create Scenario</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Scenario Modal -->
    <div id="edit-scenario-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Edit Scenario</h3>
                <span class="close-modal" onclick="closeModal('edit-scenario-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-scenario-id">
                
                <div class="form-group">
                    <label for="edit-scenario-name">Scenario Name:</label>
                    <input type="text" id="edit-scenario-name">
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label for="edit-scenario-description">Description:</label>
                    <textarea id="edit-scenario-description" rows="3"></textarea>
                </div>
                
                <div class="modal-actions" style="margin-top: 25px; text-align: right;">
                    <button class="btn-secondary" onclick="closeModal('edit-scenario-modal')">Cancel</button>
                    <button class="btn-primary" onclick="handleSaveScenarioEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Template Modal -->
    <div id="load-template-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Load Scenario Template</h3>
                <span class="close-modal" onclick="closeModal('load-template-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">Select a template to create a new scenario with pre-configured assumptions:</p>
                
                <div class="template-options">
                    <div class="template-card" onclick="handleLoadTemplate('best-case')">
                        <h4> Best Case</h4>
                        <p>Optimistic growth (25%) with improved margins and working capital efficiency</p>
                    </div>
                    
                    <div class="template-card" onclick="handleLoadTemplate('worst-case')">
                        <h4> Worst Case</h4>
                        <p>Conservative growth (3%) with slow collections and cash preservation focus</p>
                    </div>
                    
                    <div class="template-card" onclick="handleLoadTemplate('high-growth')">
                        <h4> High Growth</h4>
                        <p>Aggressive expansion (40%) with heavy investment in CapEx and working capital</p>
                    </div>
                    
                    <div class="template-card" onclick="handleLoadTemplate('cash-conservation')">
                        <h4> Cash Conservation</h4>
                        <p>Extend runway with aggressive collections, extended payables, and minimal CapEx</p>
                    </div>
                    
                    <div class="template-card" onclick="handleLoadTemplate('recession')">
                        <h4> Recession</h4>
                        <p>Economic downturn with negative growth (-5%), slow payments, and cash hoarding</p>
                    </div>
                </div>
                
                <div class="modal-actions" style="margin-top: 25px; text-align: right;">
                    <button class="btn-secondary" onclick="closeModal('load-template-modal')">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirm-delete-modal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header" style="background: #fff3cd; border-bottom: 2px solid #ffc107;">
                <h3 style="color: #856404;"> Confirm Delete</h3>
                <span class="close-modal" onclick="closeModal('confirm-delete-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm-delete-message" style="font-size: 1.05em; color: #333; margin-bottom: 20px;">
                    Are you sure you want to delete this scenario?
                </p>
                <p style="font-size: 0.9em; color: #666;">
                    This action cannot be undone.
                </p>
                
                <div class="modal-actions" style="margin-top: 25px; text-align: right;">
                    <button class="btn-secondary" onclick="closeModal('confirm-delete-modal')">Cancel</button>
                    <button id="confirm-delete-btn" class="btn-danger" style="background: #dc3545; color: white;">Delete Scenario</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Expanded Chart Modal -->
    <div id="expanded-chart-modal" class="modal">
        <div class="modal-content" style="max-width: 98%; max-height: 98vh; width: 95%; height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="padding: 15px 20px; flex-shrink: 0;">
                <h3 id="expanded-chart-title" style="margin: 0; font-size: 1.2em;">Chart</h3>
                <span class="close-modal" onclick="closeModal('expanded-chart-modal')">&times;</span>
            </div>
            <div class="modal-body" style="padding: 15px 20px 20px 20px; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                <!-- Chart controls - compact layout -->
                <div class="chart-controls" style="margin-bottom: 12px; display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 8px; align-items: center;">
                    <div class="chart-control-item" style="gap: 6px;">
                        <select id="expandedLineColor1" class="color-picker-select" style="font-size: 0.85em; background-color: #3498db;">
                            <option value="#3498db" style="color: #3498db;" selected></option>
                            <option value="#e74c3c" style="color: #e74c3c;"></option>
                            <option value="#27ae60" style="color: #27ae60;"></option>
                            <option value="#000000" style="color: #000000;"></option>
                            <option value="#9b59b6" style="color: #9b59b6;"></option>
                            <option value="#e91e63" style="color: #e91e63;"></option>
                            <option value="#f39c12" style="color: #f39c12;"></option>
                            <option value="#f1c40f" style="color: #f1c40f;"></option>
                            <option value="#34495e" style="color: #34495e;"></option>
                            <option value="#95a5a6" style="color: #95a5a6;"></option>
                            <option value="#1abc9c" style="color: #1abc9c;"></option>
                        </select>
                        <select id="expandedLineItem1" style="font-size: 0.85em; padding: 4px 8px;">
                            <option value="">Select line item 1</option>
                        </select>
                    </div>
                    <div class="chart-control-item" style="gap: 6px;">
                        <select id="expandedLineColor2" class="color-picker-select" style="font-size: 0.85em; background-color: #e74c3c;">
                            <option value="#3498db" style="color: #3498db;"></option>
                            <option value="#e74c3c" style="color: #e74c3c;" selected></option>
                            <option value="#27ae60" style="color: #27ae60;"></option>
                            <option value="#000000" style="color: #000000;"></option>
                            <option value="#9b59b6" style="color: #9b59b6;"></option>
                            <option value="#e91e63" style="color: #e91e63;"></option>
                            <option value="#f39c12" style="color: #f39c12;"></option>
                            <option value="#f1c40f" style="color: #f1c40f;"></option>
                            <option value="#34495e" style="color: #34495e;"></option>
                            <option value="#95a5a6" style="color: #95a5a6;"></option>
                            <option value="#1abc9c" style="color: #1abc9c;"></option>
                        </select>
                        <select id="expandedLineItem2" style="font-size: 0.85em; padding: 4px 8px;">
                            <option value="">Select line item 2</option>
                        </select>
                    </div>
                    <div class="chart-control-item" style="gap: 6px;">
                        <select id="expandedLineColor3" class="color-picker-select" style="font-size: 0.85em; background-color: #27ae60;">
                            <option value="#3498db" style="color: #3498db;"></option>
                            <option value="#e74c3c" style="color: #e74c3c;"></option>
                            <option value="#27ae60" style="color: #27ae60;" selected></option>
                            <option value="#000000" style="color: #000000;"></option>
                            <option value="#9b59b6" style="color: #9b59b6;"></option>
                            <option value="#e91e63" style="color: #e91e63;"></option>
                            <option value="#f39c12" style="color: #f39c12;"></option>
                            <option value="#f1c40f" style="color: #f1c40f;"></option>
                            <option value="#34495e" style="color: #34495e;"></option>
                            <option value="#95a5a6" style="color: #95a5a6;"></option>
                            <option value="#1abc9c" style="color: #1abc9c;"></option>
                        </select>
                        <select id="expandedLineItem3" style="font-size: 0.85em; padding: 4px 8px;">
                            <option value="">Select line item 3</option>
                        </select>
                    </div>
                    <div class="chart-date-range" style="display: flex; gap: 6px; align-items: center; white-space: nowrap;">
                        <select id="expandedChartStartPeriod" style="padding: 4px 8px; font-size: 0.85em; min-width: 100px;">
                            <option value="">All periods</option>
                        </select>
                        <span style="font-size: 0.85em; color: #666;">to</span>
                        <select id="expandedChartEndPeriod" style="padding: 4px 8px; font-size: 0.85em; min-width: 100px;">
                            <option value="">End</option>
                        </select>
                        <button class="btn-secondary" onclick="updateExpandedChart()" style="padding: 4px 12px; font-size: 0.85em;">Update</button>
                    </div>
                </div>
                
                <!-- Expanded chart - taller and fully visible -->
                <div id="expandedLineChart" class="line-chart" style="height: calc(85vh - 180px); width: 100%; min-height: 450px; display: flex; align-items: center; justify-content: center;">
                    <div class="loading">Select line items to display chart</div>
                </div>
            </div>
        </div>
    </div>

    <script src="src/app.js?v=20250920" defer></script>
</body>
</html>
